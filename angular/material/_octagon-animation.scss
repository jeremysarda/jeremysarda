
// Example Usage
//
// <div class="wrapper">
//   <div class="octagon">
//     <div class="side"></div>
//     <div class="side"></div>
//     <div class="side"></div>
//     <div class="side"></div>
//     <div class="side"></div>
//     <div class="side"></div>
//     <div class="side"></div>
//     <div class="side"></div>
//   </div>
// </div>

$size: 100px;
$sideCount: 8;
$y: 0, 180deg, -90deg, 90deg, -45deg, 135deg, 45deg, -135deg;
$spinTime: 20s;
$metamorphosesTime: 2s;
$color: #8a8a8a;

@mixin animation($name) {
  @-webkit-keyframes #{$name} {
    @content;
  }
  @-moz-keyframes #{$name} {
    @content;
  }
  @-o-keyframes #{$name} {
    @content;
  }
  @keyframes #{$name} {
    @content;
  }
}

@mixin animation-use($name, $time) {
  -webkit-animation: $name $time infinite linear;
  -moz-animation: $name $time infinite linear;
  -o-animation: $name $time infinite linear;
  animation: $name $time infinite linear;
}

@mixin sidePosition($y, $z) {
  -webkit-transform: rotateY($y) translateZ($z);
  -ms-transform: rotateY($y) translateZ($z);
  transform: rotateY($y) translateZ($z);
}

@include animation(spin) {
  100% {
    -webkit-transform: rotateY(-360deg) rotateZ(-90deg);
    -ms-transform: rotateY(-360deg) rotateZ(-90deg);
    transform: rotateY(-360deg) rotateZ(-90deg);
  }
}

.animation-wrapper {
  -webkit-perspective: 900px;
  -ms-perspective: 900px;
  perspective: 900px;

  .octagon {
    position: absolute;
    left: 50%;
    top: 50vh;
    width: $size;
    height: $size;
    margin-left: -$size/2;
    margin-top: -$size/2;
    transform-style: preserve-3d;
    transform: rotateY(0) rotateZ(-90deg);
    @include animation-use(spin, $spinTime);

    .side {
      position: absolute;
      width: $size;
      height: $size;
      box-shadow: inset 0 0 $size/2 $color;

      @for $i from 1 through $sideCount {
        @include animation(metamorphoses+$i) {
          10%, 20% {
            @include sidePosition(nth($y, $i), .2*$size);
          }

          25%, 35% {
            @include sidePosition(nth($y, $i), .5*$size);
          }

          40%, 60% {
            @include sidePosition(nth($y, $i), 1.19*$size);
          }

          65%, 75% {
            @include sidePosition(nth($y, $i), .5*$size);
          }

          80%, 90% {
            @include sidePosition(nth($y, $i), .2*$size);
          }
        }

        &:nth-child(#{$i}) {
          @include animation-use(metamorphoses+$i, $metamorphosesTime);
        }
      }
    }
  }
}